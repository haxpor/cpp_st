# LiteralStringInBSS

## MSVC (2019)

### Default optimization level

Following is inspected with `dumpbin.exe /ALL main.exe` then grep for relevent literal strings
we've defined in the source code.

```
SECTION HEADER #2
  .rdata name
   12F88 virtual size
   24000 virtual address (0000000140024000 to 0000000140036F87)
   13000 size of raw data
   22C00 file pointer to raw data (00022C00 to 00035BFF)
       0 file pointer to relocation table
       0 file pointer to line numbers
       0 number of relocations
       0 number of line numbers
40000040 flags
         Initialized Data
         Read Only

RAW DATA #2
  0000000140024020: 28 6A 03 00 00 00 00 00 40 6A 03 00 00 00 00 00  (j......@j......
  0000000140024030: 56 6A 03 00 00 00 00 00 6C 6A 03 00 00 00 00 00  Vj......lj......
  0000000140024080: 16 6B 03 00 00 00 00 00 28 6B 03 00 00 00 00 00  .k......(k......
  0000000140024090: 38 6B 03 00 00 00 00 00 4A 6B 03 00 00 00 00 00  8k......Jk......
  00000001400240A0: 5C 6B 03 00 00 00 00 00 68 6B 03 00 00 00 00 00  \k......hk......
  00000001400240B0: 7C 6B 03 00 00 00 00 00 96 6B 03 00 00 00 00 00  |k.......k......
  00000001400240E0: 0C 6C 03 00 00 00 00 00 28 6C 03 00 00 00 00 00  .l......(l......
  00000001400240F0: 42 6C 03 00 00 00 00 00 58 6C 03 00 00 00 00 00  Bl......Xl......
  0000000140024100: 6E 6C 03 00 00 00 00 00 84 6C 03 00 00 00 00 00  nl.......l......
  0000000140024110: 98 6C 03 00 00 00 00 00 6C 6F 03 00 00 00 00 00  .l......lo......
  0000000140024150: 1C 6D 03 00 00 00 00 00 2C 6D 03 00 00 00 00 00  .m......,m......
  0000000140024160: 38 6D 03 00 00 00 00 00 4E 6D 03 00 00 00 00 00  8m......Nm......
  0000000140024170: 5C 6D 03 00 00 00 00 00 72 6D 03 00 00 00 00 00  \m......rm......
  0000000140024180: 84 6D 03 00 00 00 00 00 96 6D 03 00 00 00 00 00  .m.......m......
  00000001400241C0: 06 6E 03 00 00 00 00 00 1A 6E 03 00 00 00 00 00  .n.......n......
  00000001400241D0: 2A 6E 03 00 00 00 00 00 3C 6E 03 00 00 00 00 00  *n......<n......
  00000001400241E0: 48 6E 03 00 00 00 00 00 58 6E 03 00 00 00 00 00  Hn......Xn......
  00000001400241F0: 6C 6E 03 00 00 00 00 00 7C 6E 03 00 00 00 00 00  ln......|n......
  0000000140024200: 8A 6E 03 00 00 00 00 00 96 6E 03 00 00 00 00 00  .n.......n......
  0000000140024240: 16 6F 03 00 00 00 00 00 30 6F 03 00 00 00 00 00  .o......0o......
  0000000140024250: 40 6F 03 00 00 00 00 00 52 6F 03 00 00 00 00 00  @o......Ro......
  0000000140024260: 5E 6F 03 00 00 00 00 00 7C 6F 03 00 00 00 00 00  ^o......|o......
  00000001400242A0: 00 00 00 00 00 00 00 00 48 75 00 40 01 00 00 00  ........Hu.@....
  00000001400242B0: 94 10 00 40 01 00 00 00 38 10 00 40 01 00 00 00  ...@....8..@....
  00000001400242C0: 00 10 00 40 01 00 00 00 88 10 00 40 01 00 00 00  ...@.......@....
  0000000140024300: 00 00 00 00 00 00 00 00 80 74 00 40 01 00 00 00  .........t.@....
  0000000140024340: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  0000000140024370: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  0000000140024380: 64 65 66 61 75 6C 74 20 73 74 72 69 6E 67 00 00  default string..
  0000000140024390: 73 74 72 69 6E 67 20 69 73 20 30 00 00 00 00 00  string is 0.....
  00000001400243A0: 73 74 72 69 6E 67 20 69 73 20 31 00 00 00 00 00  string is 1.....
  00000001400243B0: 73 74 72 69 6E 67 20 69 73 20 73 6F 6D 65 74 68  string is someth
Binary file (standard input) matches
```

### Optimization level 2

Only literal strings that were used are included in read-only section.

```
  00000001400224F0: 3A 3A 66 61 69 6C 62 69 74 20 73 65 74 00 00 00  ::failbit set...
  0000000140022500: 69 6F 73 5F 62 61 73 65 3A 3A 65 6F 66 62 69 74  ios_base::eofbit
  0000000140022510: 20 73 65 74 00 00 00 00 73 74 72 69 6E 67 20 69   set....string i
  0000000140022520: 73 20 30 00 00 00 00 00 73 74 72 69 6E 67 20 69  s 0.....string i
  0000000140022530: 73 20 73 6F 6D 65 74 68 69 6E 67 20 65 6C 73 65  s something else
  0000000140022540: 00 00 00 00 00 00 00 00 62 61 64 20 61 6C 6C 6F  ........bad allo
  0000000140022550: 63 61 74 69 6F 6E 00 00 00 1A 03 40 01 00 00 00  cation.....@....
  0000000140022560: 00 21 00 40 01 00 00 00 50 25 00 40 01 00 00 00  .!.@....P%.@....
```

## GCC (9.3)

### Default optimization level

Executed `objdump -s -j .rodata a.out` to output read-only section.
We see that it have all literal strings are there.

```
objdump -s -j .rodata a.out

a.out:     file format elf64-x86-64

Contents of section .rodata:
 2000 01000200 64656661 756c7420 73747269  ....default stri
 2010 6e670073 7472696e 67206973 20300073  ng.string is 0.s
 2020 7472696e 67206973 20310073 7472696e  tring is 1.strin
 2030 67206973 20736f6d 65746869 6e672065  g is something e
 2040 6c736500                             lse.
```

### Optimization level 2

Only literal strings used in the source code are there.

```
a.out:     file format elf64-x86-64

Contents of section .rodata:
 2000 01000200 73747269 6e672069 73203000  ....string is 0.
 2010 73747269 6e672069 7320736f 6d657468  string is someth
 2020 696e6720 656c7365 00                 ing else.
```
